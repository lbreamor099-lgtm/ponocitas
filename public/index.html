<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eva x - Versi√≥n Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --lila: #6a1b9a; --neon: #00d2ff; }
        body { background: #0a001a; color: white; font-family: 'Segoe UI', sans-serif; min-height: 100vh; margin: 0; display: flex; align-items: center; justify-content: center; }
        #contador { position: fixed; top: 15px; left: 15px; background: rgba(0,210,255,0.15); border: 1px solid var(--neon); padding: 5px 15px; border-radius: 20px; font-size: 14px; z-index: 1000; }
        .cuadro-lila { background: #1a0033; border: 2px solid var(--neon); border-radius: 25px; padding: 30px; width: 95%; max-width: 450px; box-shadow: 0 0 40px rgba(0, 210, 255, 0.25); }
        .header-img { width: 100%; border-radius: 15px; margin-bottom: 20px; display: block; min-height: 100px; background: #240046; }
        input { background: rgba(255,255,255,0.05) !important; color: white !important; border: 1px solid var(--neon) !important; margin-bottom: 10px; border-radius: 10px !important; }
        .btn-entrar { background: var(--neon); color: black; font-weight: bold; border-radius: 12px; transition: 0.3s; }
        #seccion-espera, #panel-jefe { display: none; }
    </style>
</head>
<body>

    <div id="contador">üë• Personas: <span id="num-online">0</span></div>

    <div id="pantalla-registro" class="cuadro-lila text-center">
        <img id="img-bienvenida" src="https://via.placeholder.com/400x150/240046/00d2ff?text=BIENVENIDO+A+EVA" class="header-img">
        <h4 class="mb-4">REGISTRO DE USUARIO</h4>
        
        <div class="mb-3 text-start">
            <label class="small text-info ml-2">Foto de Perfil</label>
            <input type="file" id="reg-foto" class="form-control" accept="image/*">
        </div>
        
        <input type="text" id="reg-nombre" class="form-control" placeholder="Nombre y Apellidos">
        <input type="text" id="reg-pais" class="form-control" placeholder="Pa√≠s">
        <input type="text" id="reg-ciudad" class="form-control" placeholder="Ciudad">

        <button class="btn btn-entrar w-100 py-2 mt-2" onclick="verificarYEntrar()">INICIAR SESI√ìN</button>
        
        <div class="mt-4 text-end">
            <button class="btn btn-sm btn-outline-info" style="font-size: 11px;">üì• Descargar Aplicaci√≥n</button>
        </div>
    </div>

    <div id="seccion-espera" class="text-center p-4">
        <h2 class="text-info">‚åõ PROCESANDO...</h2>
        <p>Espera tu confirmaci√≥n de aprobaci√≥n del administrador.</p>
    </div>

    <div id="panel-jefe" class="cuadro-lila">
        <h4 class="text-warning text-center">üïπÔ∏è MANDO MAESTRO</h4>
        <div id="solicitudes" class="my-3 border rounded p-2" style="max-height: 150px; overflow-y: auto;"></div>
        <hr>
        <label class="small">Cambiar Imagen desde Galer√≠a</label>
        <input type="file" id="input-portada" class="form-control" accept="image/*" onchange="actualizarPortada(this)">
        <button class="btn btn-danger w-100 mt-3" onclick="alert('Grupo Cerrado')">üîí CERRAR GRUPO</button>
    </div>

    <script>
        const socket = io();
        let modoJefe = false;

        socket.on('contador', (c) => document.getElementById('num-online').innerText = c);

        function verificarYEntrar() {
            const nom = document.getElementById('reg-nombre').value;
            // TU CLAVE PERSONAL AQU√ç
            if(nom === "ADMIN_EVA") { 
                modoJefe = true;
                document.getElementById('pantalla-registro').style.display = 'none';
                document.getElementById('panel-jefe').style.display = 'block';
            } else {
                document.getElementById('pantalla-registro').style.display = 'none';
                document.getElementById('seccion-espera').style.display = 'block';
                socket.emit('registro', { 
                    nombre: nom, 
                    pais: document.getElementById('reg-pais').value,
                    ciudad: document.getElementById('reg-ciudad').value 
                });
            }
        }

        socket.on('peticion_acceso', (datos) => {
            if(modoJefe) {
                const lista = document.getElementById('solicitudes');
                lista.innerHTML += `<div class="d-flex justify-content-between mb-2 p-1 bg-dark rounded">
                    <span class="small">üë§ ${datos.nombre}</span>
                    <button class="btn btn-success btn-sm" onclick="socket.emit('aprobar_usuario', '${datos.id}')">OK</button>
                </div>`;
            }
        });

        function actualizarPortada(input) {
            const f = input.files[0];
            const r = new FileReader();
            r.onload = (e) => socket.emit('archivo_multimedia', { tipo: 'portada', buffer: e.target.result });
            r.readAsDataURL(f);
        }

        socket.on('nuevo_archivo', (data) => {
            if(data.tipo === 'portada') {
                document.getElementById('img-bienvenida').src = data.buffer;
            }
        });
    </script>
</body>
</html>

